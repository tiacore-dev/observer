{
  "upgrade": [
    "CREATE TABLE IF NOT EXISTS \"accounts\" (\n    \"account_id\" BIGSERIAL NOT NULL PRIMARY KEY,\n    \"username\" VARCHAR(255),\n    \"account_name\" VARCHAR(255),\n    \"created_at\" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP\n);\nCREATE TABLE IF NOT EXISTS \"chats\" (\n    \"chat_id\" BIGSERIAL NOT NULL PRIMARY KEY,\n    \"chat_name\" VARCHAR(255),\n    \"created_at\" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP\n);\nCREATE TABLE IF NOT EXISTS \"companies\" (\n    \"company_id\" UUID NOT NULL PRIMARY KEY,\n    \"company_name\" VARCHAR(255) NOT NULL,\n    \"description\" TEXT\n);\nCREATE TABLE IF NOT EXISTS \"account_company_relations\" (\n    \"account_company_relation_id\" UUID NOT NULL PRIMARY KEY,\n    \"account_id\" BIGINT NOT NULL REFERENCES \"accounts\" (\"account_id\") ON DELETE CASCADE,\n    \"company_id\" UUID NOT NULL REFERENCES \"companies\" (\"company_id\") ON DELETE CASCADE\n);\nCREATE TABLE IF NOT EXISTS \"bots\" (\n    \"bot_id\" BIGSERIAL NOT NULL PRIMARY KEY,\n    \"bot_token\" VARCHAR(255) NOT NULL,\n    \"secret_token\" VARCHAR(255) NOT NULL,\n    \"bot_username\" VARCHAR(255) NOT NULL,\n    \"bot_first_name\" VARCHAR(255) NOT NULL,\n    \"is_active\" BOOL NOT NULL DEFAULT False,\n    \"created_at\" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"comment\" TEXT,\n    \"company_id\" UUID NOT NULL REFERENCES \"companies\" (\"company_id\") ON DELETE CASCADE\n);\nCREATE TABLE IF NOT EXISTS \"bot_chat_relations\" (\n    \"bot_chat_relation_id\" UUID NOT NULL PRIMARY KEY,\n    \"is_admin\" BOOL NOT NULL DEFAULT False,\n    \"bot_id\" BIGINT NOT NULL REFERENCES \"bots\" (\"bot_id\") ON DELETE CASCADE,\n    \"chat_id\" BIGINT NOT NULL REFERENCES \"chats\" (\"chat_id\") ON DELETE CASCADE\n);\nCREATE TABLE IF NOT EXISTS \"messages\" (\n    \"message_id\" VARCHAR(255) NOT NULL PRIMARY KEY,\n    \"timestamp\" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"text\" TEXT,\n    \"s3_key\" VARCHAR(255),\n    \"account_id\" BIGINT NOT NULL REFERENCES \"accounts\" (\"account_id\") ON DELETE CASCADE,\n    \"chat_id\" BIGINT NOT NULL REFERENCES \"chats\" (\"chat_id\") ON DELETE CASCADE\n);\nCREATE TABLE IF NOT EXISTS \"permissions\" (\n    \"permission_id\" VARCHAR(255) NOT NULL PRIMARY KEY,\n    \"permission_name\" VARCHAR(255) NOT NULL,\n    \"comment\" VARCHAR(255)\n);\nCREATE TABLE IF NOT EXISTS \"prompts\" (\n    \"prompt_id\" UUID NOT NULL PRIMARY KEY,\n    \"prompt_name\" VARCHAR(255) NOT NULL,\n    \"text\" TEXT NOT NULL,\n    \"created_at\" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"company_id\" UUID NOT NULL REFERENCES \"companies\" (\"company_id\") ON DELETE CASCADE\n);\nCREATE TABLE IF NOT EXISTS \"chat_schedules\" (\n    \"schedule_id\" UUID NOT NULL PRIMARY KEY,\n    \"schedule_type\" VARCHAR(20) NOT NULL,\n    \"interval_hours\" INT,\n    \"interval_minutes\" INT,\n    \"time_of_day\" TIMETZ,\n    \"cron_expression\" VARCHAR(100),\n    \"run_at\" TIMESTAMPTZ,\n    \"enabled\" BOOL NOT NULL DEFAULT True,\n    \"last_run_at\" TIMESTAMPTZ,\n    \"created_at\" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"send_strategy\" VARCHAR(10) NOT NULL DEFAULT 'fixed',\n    \"send_after_minutes\" INT,\n    \"time_to_send\" TIMETZ,\n    \"bot_id\" BIGINT NOT NULL REFERENCES \"bots\" (\"bot_id\") ON DELETE CASCADE,\n    \"chat_id\" BIGINT NOT NULL REFERENCES \"chats\" (\"chat_id\") ON DELETE CASCADE,\n    \"company_id\" UUID NOT NULL REFERENCES \"companies\" (\"company_id\") ON DELETE CASCADE,\n    \"prompt_id\" UUID NOT NULL REFERENCES \"prompts\" (\"prompt_id\") ON DELETE CASCADE\n);\nCREATE TABLE IF NOT EXISTS \"analysis_results\" (\n    \"analysis_id\" UUID NOT NULL PRIMARY KEY,\n    \"result_text\" TEXT NOT NULL,\n    \"created_at\" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"date_from\" TIMESTAMPTZ NOT NULL,\n    \"date_to\" TIMESTAMPTZ NOT NULL,\n    \"tokens_input\" INT NOT NULL,\n    \"tokens_output\" INT NOT NULL,\n    \"send_time\" BIGINT,\n    \"chat_id\" BIGINT NOT NULL REFERENCES \"chats\" (\"chat_id\") ON DELETE CASCADE,\n    \"company_id\" UUID NOT NULL REFERENCES \"companies\" (\"company_id\") ON DELETE CASCADE,\n    \"prompt_id\" UUID NOT NULL REFERENCES \"prompts\" (\"prompt_id\") ON DELETE CASCADE,\n    \"schedule_id\" UUID REFERENCES \"chat_schedules\" (\"schedule_id\") ON DELETE CASCADE\n);\nCREATE TABLE IF NOT EXISTS \"target_chats\" (\n    \"target_chat_id\" UUID NOT NULL PRIMARY KEY,\n    \"chat_id\" BIGINT NOT NULL REFERENCES \"chats\" (\"chat_id\") ON DELETE CASCADE,\n    \"schedule_id\" UUID NOT NULL REFERENCES \"chat_schedules\" (\"schedule_id\") ON DELETE CASCADE\n);\nCREATE TABLE IF NOT EXISTS \"user_roles\" (\n    \"role_id\" UUID NOT NULL PRIMARY KEY,\n    \"role_name\" VARCHAR(50) NOT NULL UNIQUE,\n    \"role_system_name\" VARCHAR(50) UNIQUE\n);\nCREATE TABLE IF NOT EXISTS \"role_permission_relations\" (\n    \"role_permission_id\" UUID NOT NULL PRIMARY KEY,\n    \"created_at\" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"permission_id\" VARCHAR(255) NOT NULL REFERENCES \"permissions\" (\"permission_id\") ON DELETE CASCADE,\n    \"role_id\" UUID NOT NULL REFERENCES \"user_roles\" (\"role_id\") ON DELETE CASCADE\n);\nCREATE TABLE IF NOT EXISTS \"users\" (\n    \"user_id\" UUID NOT NULL PRIMARY KEY,\n    \"username\" VARCHAR(50) NOT NULL UNIQUE,\n    \"password_hash\" VARCHAR(255) NOT NULL,\n    \"created_at\" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP\n);\nCREATE TABLE IF NOT EXISTS \"user_company_relations\" (\n    \"user_company_relation_id\" UUID NOT NULL PRIMARY KEY,\n    \"company_id\" UUID NOT NULL REFERENCES \"companies\" (\"company_id\") ON DELETE CASCADE,\n    \"role_id\" UUID NOT NULL REFERENCES \"user_roles\" (\"role_id\") ON DELETE CASCADE,\n    \"user_id\" UUID NOT NULL REFERENCES \"users\" (\"user_id\") ON DELETE CASCADE\n);\nCREATE TABLE IF NOT EXISTS \"aerich\" (\n    \"id\" SERIAL NOT NULL PRIMARY KEY,\n    \"version\" VARCHAR(255) NOT NULL,\n    \"app\" VARCHAR(20) NOT NULL\n);"
  ]
}