{
  "upgrade": [
    "CREATE TABLE IF NOT EXISTS \"companies\" (\n    \"company_id\" UUID NOT NULL PRIMARY KEY,\n    \"company_name\" VARCHAR(255) NOT NULL,\n    \"description\" TEXT\n);\nCREATE TABLE IF NOT EXISTS \"prompts\" (\n    \"prompt_id\" UUID NOT NULL PRIMARY KEY,\n    \"prompt_name\" VARCHAR(255) NOT NULL,\n    \"text\" TEXT NOT NULL,\n    \"use_automatic\" BOOL DEFAULT False,\n    \"created_at\" BIGINT NOT NULL,\n    \"company_id\" UUID NOT NULL REFERENCES \"companies\" (\"company_id\") ON DELETE CASCADE\n);\nCREATE TABLE IF NOT EXISTS \"chats\" (\n    \"chat_id\" BIGSERIAL NOT NULL PRIMARY KEY,\n    \"chat_name\" VARCHAR(255),\n    \"created_at\" BIGINT NOT NULL,\n    \"company_id\" UUID NOT NULL REFERENCES \"companies\" (\"company_id\") ON DELETE CASCADE,\n    \"default_prompt_id\" UUID NOT NULL REFERENCES \"prompts\" (\"prompt_id\") ON DELETE CASCADE\n);\nCREATE TABLE IF NOT EXISTS \"bots\" (\n    \"bot_id\" BIGSERIAL NOT NULL PRIMARY KEY,\n    \"bot_token\" VARCHAR(255) NOT NULL,\n    \"bot_name\" VARCHAR(255) NOT NULL,\n    \"is_active\" BOOL NOT NULL DEFAULT True,\n    \"created_at\" BIGINT NOT NULL,\n    \"company_id\" UUID NOT NULL REFERENCES \"companies\" (\"company_id\") ON DELETE CASCADE,\n    \"target_chat_id_id\" BIGINT REFERENCES \"chats\" (\"chat_id\") ON DELETE CASCADE\n);\nCREATE TABLE IF NOT EXISTS \"chat_schedules\" (\n    \"schedule_id\" SERIAL NOT NULL PRIMARY KEY,\n    \"schedule_type\" VARCHAR(20) NOT NULL,\n    \"interval_hours\" INT,\n    \"interval_minutes\" INT,\n    \"time_of_day\" TIMETZ,\n    \"cron_expression\" VARCHAR(100),\n    \"run_at\" TIMESTAMPTZ,\n    \"enabled\" BOOL NOT NULL DEFAULT True,\n    \"last_run_at\" TIMESTAMPTZ,\n    \"created_at\" BIGINT NOT NULL,\n    \"chat_id\" BIGINT NOT NULL REFERENCES \"chats\" (\"chat_id\") ON DELETE CASCADE\n);\nCREATE TABLE IF NOT EXISTS \"user_roles\" (\n    \"role_id\" VARCHAR(50) NOT NULL PRIMARY KEY,\n    \"role_name\" VARCHAR(50) NOT NULL UNIQUE\n);\nCOMMENT ON COLUMN \"user_roles\".\"role_id\" IS 'ADMIN: admin\\nUSER: user\\nMODERATOR: moderator';\nCREATE TABLE IF NOT EXISTS \"admin_users\" (\n    \"admin_id\" UUID NOT NULL PRIMARY KEY,\n    \"username\" VARCHAR(50) NOT NULL UNIQUE,\n    \"password_hash\" VARCHAR(255) NOT NULL,\n    \"created_at\" BIGINT NOT NULL,\n    \"company_id\" UUID NOT NULL REFERENCES \"companies\" (\"company_id\") ON DELETE CASCADE,\n    \"role_id\" VARCHAR(50) NOT NULL REFERENCES \"user_roles\" (\"role_id\") ON DELETE CASCADE\n);\nCREATE TABLE IF NOT EXISTS \"users\" (\n    \"user_id\" BIGSERIAL NOT NULL PRIMARY KEY,\n    \"username\" VARCHAR(255),\n    \"account_name\" VARCHAR(255),\n    \"created_at\" BIGINT NOT NULL,\n    \"company_id\" UUID NOT NULL REFERENCES \"companies\" (\"company_id\") ON DELETE CASCADE,\n    \"role_id\" VARCHAR(50) NOT NULL REFERENCES \"user_roles\" (\"role_id\") ON DELETE CASCADE\n);\nCREATE TABLE IF NOT EXISTS \"analysis_results\" (\n    \"analysis_id\" UUID NOT NULL PRIMARY KEY,\n    \"result_text\" TEXT NOT NULL,\n    \"created_at\" BIGINT NOT NULL,\n    \"date_from\" BIGINT,\n    \"date_to\" BIGINT,\n    \"tokens_input\" INT NOT NULL,\n    \"tokens_output\" INT NOT NULL,\n    \"chat_id\" BIGINT REFERENCES \"chats\" (\"chat_id\") ON DELETE CASCADE,\n    \"company_id\" UUID NOT NULL REFERENCES \"companies\" (\"company_id\") ON DELETE CASCADE,\n    \"prompt_id\" UUID NOT NULL REFERENCES \"prompts\" (\"prompt_id\") ON DELETE CASCADE,\n    \"schedule_id\" INT REFERENCES \"chat_schedules\" (\"schedule_id\") ON DELETE CASCADE,\n    \"user_id\" BIGINT REFERENCES \"users\" (\"user_id\") ON DELETE CASCADE\n);\nCREATE TABLE IF NOT EXISTS \"messages\" (\n    \"message_id\" UUID NOT NULL PRIMARY KEY,\n    \"timestamp\" BIGINT NOT NULL,\n    \"text\" TEXT,\n    \"s3_key\" VARCHAR(255),\n    \"chat_id\" BIGINT NOT NULL REFERENCES \"chats\" (\"chat_id\") ON DELETE CASCADE,\n    \"user_id\" BIGINT NOT NULL REFERENCES \"users\" (\"user_id\") ON DELETE CASCADE\n);\nCREATE TABLE IF NOT EXISTS \"aerich\" (\n    \"id\" SERIAL NOT NULL PRIMARY KEY,\n    \"version\" VARCHAR(255) NOT NULL,\n    \"app\" VARCHAR(20) NOT NULL\n);"
  ]
}